<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authorize.net Accept.js Payment Demo</title>
    <script type="text/javascript" src="https://jstest.authorize.net/v1/Accept.js"></script>
    <script>
        // This function will be triggered when the payment data is submitted
        function sendPaymentDataToAnet() {
            var authData = {
                clientKey: "5FcB6WrfHGS76gHW3v7btBCE3HuuBuke9Pj96Ztfn5R32G5ep42vne7MCWZtAucY",  // Replace with your actual client key
                apiLoginID: "5KP3u95bQpv" // Replace with your actual API Login ID
            };

            var cardData = {
                cardNumber: document.getElementById("cardNumber").value,
                month: document.getElementById("expiryDate").value.split('/')[0],
                year: document.getElementById("expiryDate").value.split('/')[1],
                cardCode: document.getElementById("cvv").value
            };

            var secureData = {
                authData: authData,
                cardData: cardData
            };

            Accept.dispatchData(secureData, responseHandler);
        }

        // Handle the response from Accept.js
        function responseHandler(response) {
            if (response.messages.resultCode === "Error") {
                console.log("Error: " + response.messages.message[0].text);
                document.getElementById("resultMessage").innerText = "Error: " + response.messages.message[0].text;
            } else {
                var opaqueData = response.opaqueData;
                console.log("Received opaqueData: ", opaqueData);
                // Now that we have the opaqueData, send it to the server
                createTransaction(opaqueData);
            }
        }

        // Send the opaque data to the server to complete the transaction
        function createTransaction(opaqueData) {
            fetch('/create-transaction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    opaqueData: opaqueData,
                    amount: 100.00 // Replace with the desired transaction amount
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.transactionResponse && data.transactionResponse.responseCode === "1") {
                    document.getElementById("resultMessage").innerText = "Transaction Approved: " + data.transactionResponse.transId;
                } else {
                    document.getElementById("resultMessage").innerText = "Transaction Failed: " + (data.messages ? data.messages.message[0].text : "Unknown Error");
                }
            })
            .catch(error => {
                console.error("Error processing transaction:", error);
                document.getElementById("resultMessage").innerText = "Error processing transaction: " + error;
            });
        }
    </script>
</head>
<body>
    <h2>Authorize.net Accept.js Payment Demo</h2>
    <form onsubmit="event.preventDefault(); sendPaymentDataToAnet();">
        <div>
            <label for="cardNumber">Card Number:</label>
            <input type="text" id="cardNumber" placeholder="4111 1111 1111 1111" required>
        </div>
        <div>
            <label for="expiryDate">Expiry Date (MM/YY):</label>
            <input type="text" id="expiryDate" placeholder="12/25" required>
        </div>
        <div>
            <label for="cvv">CVV:</label>
            <input type="text" id="cvv" placeholder="123" required>
        </div>
        <div>
            <button type="submit">Submit Payment</button>
        </div>
    </form>
    <div id="resultMessage"></div>
</body>
</html>
